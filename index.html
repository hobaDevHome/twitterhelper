<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>Tweet Launcher (am / pm)</title>
    <style>
      body {
        font-family: sans-serif;
        direction: rtl;
        padding: 20px;
      }
      select,
      input,
      button {
        font-size: 18px;
        margin-top: 10px;
      }
      #status,
      #statusBlue,
      #statusManual {
        margin-top: 15px;
      }
      #reminder {
        color: red;
        font-weight: bold;
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ“‚ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù: AM Ø£Ùˆ PM</h2>

    <select id="fileSelector" onchange="loadFile()">
      <option value="">-- Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ø¯Ø¹ÙˆØ§Øª --</option>
      <option value="am.csv">am.csv</option>
      <option value="pm.csv">pm.csv</option>
    </select>

    <br />
    <button onclick="sendNext()" disabled id="nextBtn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    <p id="status"></p>

    <hr />
    <h3>ğŸ“© Ø¯Ø¹ÙˆØ§Øª Ø®Ø§ØµØ© Ù„Ø¨Ù„ÙˆØ³ÙƒØ§ÙŠ:</h3>
    <button onclick="sendBluesky()" id="blueBtn">Ø£Ø±Ø³Ù„ Ø¹Ù„Ù‰ Bluesky</button>
    <span id="reminder"></span>
    <p id="statusBlue"></p>

    <hr />
    <h3>ğŸ¦ Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ© Ù…Ù† Ø±Ù‚Ù… Ø³Ø·Ø± Ù…Ø¹ÙŠÙ† (ØªÙˆÙŠØªØ±)</h3>
    <select id="manualFileSelector" onchange="loadManualFile()">
      <option value="">-- Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ø¯Ø¹ÙˆØ§Øª --</option>
      <option value="am.csv">am.csv</option>
      <option value="pm.csv">pm.csv</option>
    </select>

    <br />
    <label for="lineNumber">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø³Ø·Ø± Ø±Ù‚Ù…:</label>
    <input type="number" id="lineNumber" min="1" />

    <br />
    <button onclick="sendManualTweet()" disabled id="manualBtn">
      Ø£Ø±Ø³Ù„ Ø§Ù„Ø³Ø·Ø±
    </button>
    <button onclick="setStartAndEnableNext()" disabled id="startFromBtn">
      Ø§Ø¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§
    </button>
    <button onclick="sendNextManual()" disabled id="manualNextBtn">
      Ø§Ù„ØªØ§Ù„ÙŠ
    </button>

    <p id="statusManual"></p>

    <!-- Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…ÙƒØªØ¨Ø© PapaParse Ù…Ù† CDN -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <script>
      const fileUrls = {
        "am.csv":
          "https://docs.google.com/spreadsheets/d/1KkM6dMGfOdg0GrEGJQTN1aI0Z5BtnyGy-hgwKS1ueSY/export?format=csv",
        "pm.csv":
          "https://docs.google.com/spreadsheets/d/1GRP2vIKYKQEhFgcjZ0lHeGsFSC4UadmS520tihjetVs/export?format=csv",
      };

      let invites = [];
      let index = 0;
      let tweetWindow;

      function loadFile() {
        const filename = document.getElementById("fileSelector").value;
        if (!filename) return;

        const fileUrl = fileUrls[filename];

        fetch(fileUrl)
          .then((response) => {
            if (!response.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù");
            return response.text();
          })
          .then((csvText) => {
            const results = Papa.parse(csvText, {
              header: false,
              skipEmptyLines: true,
            });

            // Ù†Ø£Ø®Ø° Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ØŒ Ù…Ø¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ
            invites = results.data.map((row) => row[0]);

            index = 0;
            document.getElementById("nextBtn").disabled = false;
            document.getElementById(
              "status"
            ).textContent = `ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${invites.length} Ø¯Ø¹ÙˆØ© Ù…Ù† "${filename}"`;

            const reminder = document.getElementById("reminder");
            if (filename === "pm.csv") {
              reminder.textContent = "â†ª Ù„Ø§ ØªÙ†Ø³Ù Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ§Øª Ø¨Ù„ÙˆØ³ÙƒØ§ÙŠ!";
            } else {
              reminder.textContent = "";
            }
          })
          .catch((err) => {
            console.error(err);
            document.getElementById("status").textContent =
              "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù";
          });
      }

      function sendNext() {
        if (index < invites.length) {
          const text = encodeURIComponent(invites[index++]);
          const tweetURL = `https://twitter.com/intent/tweet?text=${text}`;
          if (!tweetWindow || tweetWindow.closed) {
            tweetWindow = window.open(tweetURL, "_blank");
          } else {
            tweetWindow.location.href = tweetURL;
            tweetWindow.focus();
          }
          document.getElementById(
            "status"
          ).textContent = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø±Ù‚Ù… ${index} Ù…Ù† ${invites.length}`;
        } else {
          alert("ğŸ‰ Ø®Ù„ØµÙ†Ø§ ÙƒÙ„ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª!");
        }
      }

      const blueskyInvites = [
        "Ø±Ø¨Ù†Ø§ ÙŠØ³Ø¹Ø¯Ùƒ ÙˆÙŠØ±ÙˆÙ‚ Ø¨Ø§Ù„Ùƒ ÙˆÙŠØ·Ù…Ù†Ùƒ Ø¹Ù„Ù‰ ÙˆÙ„Ø§Ø¯Ùƒ ÙŠØ§ Ø¯ÙˆØ¯Ùˆ @rosede.bsky.social",
        "Ø±Ø¨Ù†Ø§ ÙŠØ´ÙÙŠÙƒÙŠ ÙˆÙŠÙˆÙÙ‚Ùƒ ÙˆÙŠØ±ÙŠØ­ Ø¨Ø§Ù„Ùƒ ÙˆÙŠÙØ±Ø­ Ù‚Ù„Ø¨Ùƒ ÙŠØ§ Ù†ÙˆØ¯Ø§ @farawaystar.bsky.social",
        "Ø±Ø¨Ù†Ø§ ÙŠÙˆÙÙ‚Ùƒ ÙˆÙŠÙƒØªØ¨Ù„Ùƒ Ø§Ù„Ø®ÙŠØ± ÙˆÙŠØ±Ø²Ù‚Ùƒ Ù…Ù„ÙŠÙˆÙ† Ø¯ÙˆÙ„Ø§Ø± ÙˆØªØ³Ø§ÙØ±ÙŠ Ø§Ù†ØªÙŠ ÙˆØ¬ÙˆØ²Ùƒ ÙˆÙˆÙ„Ø§Ø¯Ùƒ Ø¹Ù„Ù‰ Ø®ÙŠØ± Ù‚Ø±ÙŠØ¨ ÙŠØ§ Ø¨ÙŠØ±Ùˆ @abeergaber.bsky.social",
      ];
      let blueIndex = 0;

      function sendBluesky() {
        if (blueIndex < blueskyInvites.length) {
          const encoded = encodeURIComponent(blueskyInvites[blueIndex++]);
          const url = `https://bsky.app/intent/compose?text=${encoded}`;
          window.open(url, "_blank");
          document.getElementById(
            "statusBlue"
          ).textContent = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØ© Ø¨Ù„ÙˆØ³ÙƒØ§ÙŠ Ø±Ù‚Ù… ${blueIndex} Ù…Ù† ${blueskyInvites.length}`;
        } else {
          alert("ğŸ‰ Ø®Ù„ØµÙ†Ø§ ÙƒÙ„ Ø¯Ø¹ÙˆØ§Øª Ø¨Ù„ÙˆØ³ÙƒØ§ÙŠ!");
        }
      }

      let manualInvites = [];
      let manualStartIndex = null;

      function loadManualFile() {
        const filename = document.getElementById("manualFileSelector").value;
        if (!filename) return;

        const fileUrl = fileUrls[filename];

        fetch(fileUrl)
          .then((response) => {
            if (!response.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù");
            return response.text();
          })
          .then((csvText) => {
            const results = Papa.parse(csvText, {
              header: false,
              skipEmptyLines: true,
            });

            manualInvites = results.data.map((row) => row[0]);

            document.getElementById("manualBtn").disabled = false;
            document.getElementById("startFromBtn").disabled = false;
            document.getElementById(
              "statusManual"
            ).textContent = `ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${manualInvites.length} Ø¯Ø¹ÙˆØ© Ù…Ù† "${filename}"`;
          })
          .catch((err) => {
            console.error(err);
            document.getElementById("statusManual").textContent =
              "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù";
          });
      }

      function sendManualTweet() {
        const lineInput = document.getElementById("lineNumber").value;
        const lineNumber = parseInt(lineInput);

        if (
          isNaN(lineNumber) ||
          lineNumber < 1 ||
          lineNumber > manualInvites.length
        ) {
          alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø³Ø·Ø± ØµØ­ÙŠØ­");
          return;
        }

        const text = encodeURIComponent(manualInvites[lineNumber - 1]);
        const tweetURL = `https://twitter.com/intent/tweet?text=${text}`;

        if (!tweetWindow || tweetWindow.closed) {
          tweetWindow = window.open(tweetURL, "_blank");
        } else {
          tweetWindow.location.href = tweetURL;
          tweetWindow.focus();
        }

        document.getElementById(
          "statusManual"
        ).textContent = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø±Ù‚Ù… ${lineNumber}`;
      }

      function setStartAndEnableNext() {
        const lineInput = document.getElementById("lineNumber").value;
        const lineNumber = parseInt(lineInput);

        if (
          isNaN(lineNumber) ||
          lineNumber < 1 ||
          lineNumber > manualInvites.length
        ) {
          alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø³Ø·Ø± ØµØ­ÙŠØ­");
          return;
        }

        manualStartIndex = lineNumber - 1;
        document.getElementById("manualNextBtn").disabled = false;

        document.getElementById(
          "statusManual"
        ).textContent = `ğŸ“Œ ØªÙ… Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù…Ù† Ø§Ù„Ø³Ø·Ø± ${lineNumber}ØŒ Ø§Ø¶ØºØ·ÙŠ "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.`;
      }

      function sendNextManual() {
        if (
          manualStartIndex === null ||
          manualStartIndex >= manualInvites.length
        ) {
          alert("ğŸ‰ Ø®Ù„ØµÙ†Ø§ ÙƒÙ„ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª!");
          return;
        }

        const text = encodeURIComponent(manualInvites[manualStartIndex]);
        const tweetURL = `https://twitter.com/intent/tweet?text=${text}`;

        if (!tweetWindow || tweetWindow.closed) {
          tweetWindow = window.open(tweetURL, "_blank");
        } else {
          tweetWindow.location.href = tweetURL;
          tweetWindow.focus();
        }

        manualStartIndex++;
        document.getElementById(
          "statusManual"
        ).textContent = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ© Ø±Ù‚Ù… ${manualStartIndex}`;
      }
    </script>
  </body>
</html>
